#!/usr/bin/env bash
ERA="$HOME/.garden/presence/era/state.txt"
EPOCH="$HOME/.garden/presence/epoch/epoch.txt"
STATE="$HOME/.garden/presence/epoch/state.txt"

ER=$(cat "$ERA" 2>/dev/null)
EP=$(cat "$EPOCH" 2>/dev/null)
if [[ -z "$EP" ]]; then EP=0; fi

if [[ "$ER" == "renewal" ]]; then
  EP=$((EP + 1))
  echo "$EP" > "$EPOCH"
fi

case $(( EP % 4 )) in
  0) EST="foundation" ;;
  1) EST="expansion" ;;
  2) EST="contraction" ;;
  3) EST="rebirth" ;;
esac

echo "$EST" > "$STATE"
