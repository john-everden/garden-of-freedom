#!/usr/bin/env bash

LOOP="$HOME/.garden/presence/loop/state.txt"
BEAT="$HOME/.garden/presence/rhythm/beat.txt"
STATE="$HOME/.garden/presence/rhythm/state.txt"

# Read current loop state
CURRENT=$(cat "$LOOP" 2>/dev/null)

# Read beat counter
B=$(cat "$BEAT" 2>/dev/null)
if [[ -z "$B" ]]; then B=0; fi

# Increment beat
B=$((B + 1))
echo "$B" > "$BEAT"

# Determine rhythm state
if (( B % 4 == 0 )); then
  RSTATE="downbeat"
elif (( B % 2 == 0 )); then
  RSTATE="even"
else
  RSTATE="odd"
fi

echo "$RSTATE" > "$STATE"

echo "ðŸŒ¿ Rhythm engine
