#!/usr/bin/env bash

CYCLE="$HOME/.garden/presence/cycle/state.txt"
SEASON="$HOME/.garden/presence/season/season.txt"
STATE="$HOME/.garden/presence/season/state.txt"

# Read cycle state
C=$(cat "$CYCLE" 2>/dev/null)

# Read season counter
S=$(cat "$SEASON" 2>/dev/null)
if [[ -z "$S" ]]; then S=0; fi

# Advance season on transition
if [[ "$C" == "transition" ]]; then
  S=$((S + 1))
  echo "$S" > "$SEASON"
fi

# Determine season state
case $(( S % 4 )) in
  0) SST="dawn" ;;
  1) SST="zenith" ;;
  2) SST="dusk" ;;
  3) SST="night" ;;
esac

echo "$SST" > "$STATE"

echo "ðŸŒ¿ Season engine updated: season $S ($SST)"

