#!/usr/bin/env bash
LOOP="$HOME/.garden/presence/loop/state.txt"

# Increment loop counter
COUNT_FILE="$HOME/.garden/presence/loop/count.txt"
mkdir -p "$HOME/.garden/presence/loop"
if [[ ! -f "$COUNT_FILE" ]]; then echo 0 > "$COUNT_FILE"; fi

C=$(cat "$COUNT_FILE")
C=$((C + 1))
echo "$C" > "$COUNT_FILE"

# Map loop state
case $(( C % 4 )) in
  0) STATE="open" ;;
  1) STATE="flow" ;;
  2) STATE="return" ;;
  3) STATE="still" ;;
esac

echo "$STATE" > "$LOOP"
